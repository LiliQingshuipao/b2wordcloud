!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.B2wordcloud=e():t.B2wordcloud=e()}(this,function(){return function(t){function e(o){if(i[o])return i[o].exports;var a=i[o]={exports:{},id:o,loaded:!1};return t[o].call(a.exports,a,a.exports,e),a.loaded=!0,a.exports}var i={};return e.m=t,e.c=i,e.p="",e(0)}([function(t,e,i){"use strict";function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){var i;for(i in e)t[i]=t[i]&&"[object Object]"===t[i].toString()?a(t[i],e[i]):t[i]=e[i];return t}function n(t,e){var i=document.createElement("canvas").getContext("2d");i.fillStyle="#ffffff",i.fillRect(0,0,1,1);var o=i.getImageData(0,0,1,1).data,a=document.createElement("canvas");a.width=e.width,a.height=e.height;var n=a.getContext("2d");n.drawImage(t,0,0,t.width,t.height,0,0,a.width,a.height);for(var r=n.getImageData(0,0,e.width,e.height),s=n.createImageData(r),l=0;l<r.data.length;l+=4)r.data[l+3]>128?(s.data[l]=o[0],s.data[l+1]=o[1],s.data[l+2]=o[2],s.data[l+3]=o[3]):(s.data[l]=o[0],s.data[l+1]=o[1],s.data[l+2]=o[2],s.data[l+3]=o[3]?o[3]-1:0);n.putImageData(s,0,0),n=e.getContext("2d"),n.drawImage(a,0,0),a=n=r=s=i=o=void 0}Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(e,i,o){return i&&t(e.prototype,i),o&&t(e,o),e}}(),s=i(1),l=function(t){var e=t.backingStorePixelRatio||t.webkitBackingStorePixelRatio||t.mozBackingStorePixelRatio||t.msBackingStorePixelRatio||t.oBackingStorePixelRatio||t.backingStorePixelRatio||1;return(window.devicePixelRatio||1)/e*4},h=e.B2wordcloud=function(){function t(e,i){o(this,t),this._wrapper=e,this._wrapper.style.position="relative",this._container=null,this._tooltip=null,this._options=a({renderer:"canvas",effect:"equal",tooltip:{show:!0,formatter:null},clearCanvas:!i.maskImage},i),this._wordcloud2=null,this._maskCanvas=null,this._shapeCanvas=null,this._tempCanvas=null,this._maskImg=null,this._init(),this._cacheHoverParams={item:null,dimension:null,event:null}}return r(t,[{key:"_init",value:function(){this._sortList(this._options),this._initContainer(),this._setOptions()}},{key:"_sortList",value:function(t){t.list=t.list.sort(function(t,e){return e[1]-t[1]})}},{key:"_setDefaultFontSize",value:function(t){t.autoFontSize?(t.enableSquareAdaptor?t.maxFontSize=this._wrapper.clientWidth:t.maxFontSize=this._options.clientWidth?Math.min(this._options.clientWidth,400):400,t.minFontSize="number"==typeof t.minFontSize?t.minFontSize:10):(t.maxFontSize="number"==typeof t.maxFontSize?t.maxFontSize:36,t.minFontSize="number"==typeof t.minFontSize?t.minFontSize:10)}},{key:"_initContainer",value:function(){this._maskCanvas=document.createElement("canvas"),this._setCanvasSize(this._maskCanvas),"div"===this._options.renderer?(this._container=document.createElement("div"),this._container.style.width="100%",this._container.style.height="100%",this._createTempCanvas()):"canvas"===this._options.renderer&&(this._container=document.createElement("canvas"),this._setCanvasSize()),this._wrapper.appendChild(this._container)}},{key:"_createTempCanvas",value:function(){this._tempCanvas=document.createElement("canvas"),this._setCanvasSize(this._tempCanvas)}},{key:"_initTooltip",value:function(){this._tooltip||(this._tooltip=document.createElement("div"),this._tooltip.className=this._options.tooltip.className||"",this._tooltip.style.backgroundColor=this._options.tooltip.backgroundColor||"rgba(0,0,0,0.8)",this._tooltip.style.color="#fff",this._tooltip.style.padding="5px",this._tooltip.style.borderRadius="5px",this._tooltip.style.fontSize="13px",this._tooltip.style.lineHeight="1.4",this._tooltip.style.webkitTransition="left 0.2s, top 0.2s",this._tooltip.style.transition="left 0.2s, top 0.2s",this._tooltip.style.position="absolute",this._tooltip.style.whiteSpace="nowrap",this._tooltip.style.zIndex="999",this._tooltip.style.display="none"),document.body.appendChild(this._tooltip)}},{key:"_setCanvasSize",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._container,e=this._options.clientWidth?this._options.clientWidth:this._wrapper.clientWidth,i=this._options.clientHeight?this._options.clientHeight:this._wrapper.clientHeight;t.width=e,t.height=i,t.style.width=e+"px",t.style.height=i+"px"}},{key:"_setOptions",value:function(){var t=this;if(this._setDefaultFontSize(this._options),!this._options.weightFactor&&this._fixWeightFactor(this._options),this._options.tooltip.show){this._initTooltip();var e=void 0,i=void 0,o=void 0,a=void 0,n=this._options.hover,r=this._options.mouseout;this._options.mouseout=function(e){r&&r(e),t._cacheHoverParams.item||(t._tooltip.style.display="none");var i=e.toElement;i&&i===t._tooltip&&i.addEventListener("mouseleave",function t(){i.style.display="none",i.removeEventListener("mouseleave",t)})},this._options.hover=function(r,s,l){if(t._cacheHoverParams.item=r,t._cacheHoverParams.dimension=s,t._cacheHoverParams.event=l,n&&n(r,s,l),r){var h=r[0]+": "+r[1];"[object Function]"===Object.prototype.toString.call(t._options.tooltip.formatter)&&(h=t._options.tooltip.formatter(r)),t._tooltip.style.display="block",e=t._tooltip.clientWidth,i=t._tooltip.clientHeight,o=i+15,a=e/2+5;var c=l.pageY-o,f=l.pageX-a;if("function"==typeof t._options.tooltip.position){var d=t._options.tooltip.position(r,s,l);d&&(c=d.top,f=d.left)}t._tooltip.style.position="absolute",t._tooltip.style.top=c+"px",t._tooltip.style.left=f+"px",t._tooltip.innerHTML=h}else t._tooltip.style.display="none"}}this._options&&this._options.maskImage?this._maskImage():this._render()}},{key:"_maskImage",value:function(){var t=this,e=window.document.createElement("img");e.crossOrigin="Anonymous",e.src=this._options.maskImage,e.onload=function(){t._maskImg=e,t._shapeCanvas=document.createElement("canvas");var i=t._shapeCanvas.getContext("2d"),o=l(i);t._shapeCanvas.style.width=e.width+"px",t._shapeCanvas.style.height=e.height+"px",t._shapeCanvas.width=e.width*o,t._shapeCanvas.height=e.height*o,i.imageSmoothingEnabled=!1,i.imageSmoothingQuality="high",i.drawImage(e,0,0,e.width*o,e.height*o),i.scale(o,o);for(var a=i.getImageData(0,0,t._shapeCanvas.width,t._shapeCanvas.height),n=i.createImageData(a),r=0;r<a.data.length;r+=4){var s=a.data[r]+a.data[r+1]+a.data[r+2],h=a.data[r+3];h<128||s>384?(n.data[r]=n.data[r+1]=n.data[r+2]=255,n.data[r+3]=0):(n.data[r]=n.data[r+1]=n.data[r+2]=0,n.data[r+3]=255)}i.putImageData(n,0,0),t._render()}}},{key:"_render",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._maskImg&&n(this._shapeCanvas,this._maskCanvas),this._wordcloud2=new s("canvas"===this._options.renderer?this._container:[this._tempCanvas,this._container],this._options,this._maskCanvas,t)}},{key:"_fixWeightFactor",value:function(t){if(t.list&&t.list.length>0){var e=t.list[t.list.length-1][1],i=t.list[0][1],i=t.enableSquareAdaptor&&t.list[1]&&t.list[1][1]?t.list[1][1]:t.list[0][1];i>e?t.weightFactor=function(o){if("linerMap"===t.effect){var a=i-e,n=(t.maxFontSize-t.minFontSize)/(t.topN||5);return 0===a?0===n?t.minFontSize:(t.minFontSize+t.maxFontSize)/2:o===e?t.minFontSize:o===i?n+t.minFontSize:(o-e)/a*n+t.minFontSize}var r="number"==typeof t.fontSizeFactor?t.fontSizeFactor:1/(t.topN||5),s=(t.maxFontSize-t.minFontSize)/(Math.pow(i,r)-Math.pow(e,r)),l=t.maxFontSize-s*Math.pow(i,r);return Math.ceil(s*Math.pow(o,r)+l)}:t.weightFactor=function(e){return t.maxFontSize}}}},{key:"dispatchAction",value:function(t){switch(t.type){case"highlight":this._wordcloud2.highlight(t.dataIndex,t.keepAlive);break;case"downplay":this._wordcloud2.downplay(t.dataIndex,t.keepAlive)}}}]),t}();t.exports=h},function(t,e,i){function o(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}var a,n;(function(){/*!
	   * wordcloud2.js
	   * http://timdream.org/wordcloud2.js/
	   *
	   * Copyright 2011 - 2013 Tim Chien
	   * Released under the MIT license
	   */
"use strict";window.setImmediate||(window.setImmediate=function(){return window.msSetImmediate||window.webkitSetImmediate||window.mozSetImmediate||window.oSetImmediate||function(){if(!window.postMessage||!window.addEventListener)return null;var t=[void 0],e="zero-timeout-message",i=function(i){var o=t.length;return t.push(i),window.postMessage(e+o.toString(36),"*"),o};return window.addEventListener("message",function(i){if("string"==typeof i.data&&i.data.substr(0,e.length)===e){i.stopImmediatePropagation();var o=parseInt(i.data.substr(e.length),36);t[o]&&(t[o](),t[o]=void 0)}},!0),window.clearImmediate=function(e){t[e]&&(t[e]=void 0)},i}()||function(t){window.setTimeout(t,0)}}()),window.clearImmediate||(window.clearImmediate=function(){return window.msClearImmediate||window.webkitClearImmediate||window.mozClearImmediate||window.oClearImmediate||function(t){window.clearTimeout(t)}}()),function(i){var r=function(){var t=document.createElement("canvas");if(!t||!t.getContext)return!1;var e=t.getContext("2d");return!!e&&(!!e.getImageData&&(!!e.fillText&&(!!Array.prototype.some&&!!Array.prototype.push)))}(),s=function(){if(r){for(var t,e,i=document.createElement("canvas").getContext("2d"),o=20;o;){if(i.font=o.toString(10)+"px sans-serif",i.measureText("Ｗ").width===t&&i.measureText("m").width===e)return o+1;t=i.measureText("Ｗ").width,e=i.measureText("m").width,o--}return 0}}(),l=function(t){for(var e,i,o=t.length;o;e=Math.floor(Math.random()*o),i=t[--o],t[o]=t[e],t[e]=i);return t},h=function(t,e,i){function a(t){var e=t.length;if(e<=1)return 0;var i=t.reduce(function(t,e){return t+e},0)/e,o=t.map(function(t){return Math.pow(t-i,2)}),a=o.reduce(function(t,e){return t+e},0)/(e-1);return a}function n(t,e){return"hsl("+(360*Math.random()).toFixed()+","+(30*Math.random()+70).toFixed()+"%,"+(Math.random()*(e-t)+t).toFixed()+"%)"}if(r){Array.isArray(t)||(t=[t]);var h=function(){return!(!v.backgroundColor||"transparent"===v.backgroundColor)},c=function(){for(var t=i.getContext("2d"),e=t.getImageData(0,0,i.width,i.height),o=ht(v.backgroundColor),a=ht("#ffffff"),n=0;n<e.data.length;n+=4){for(var r=0,s=!0;r<4;){if(e.data[n+r]!==a[r]){s=!1;break}r++}s&&(e.data[n]=o[0],e.data[n+1]=o[1],e.data[n+2]=o[2],e.data[n+3]=o[3])}t.putImageData(e,0,0)},f=function(t){var e=t.backingStorePixelRatio||t.webkitBackingStorePixelRatio||t.mozBackingStorePixelRatio||t.msBackingStorePixelRatio||t.oBackingStorePixelRatio||t.backingStorePixelRatio||1;return(window.devicePixelRatio||1)/e*2},d=function(t,e){var i=document.createElement("canvas").getContext("2d");i.font=e+"px "+v.fontFamily;var o=i.measureText(t).width;return o},u=function(){var t=v.list.slice(1,5),e=t.map(function(t){var e=Array.isArray(t)?t[0]:t.word;return d(e,12)});return e},m=function(){var t=u(),e=Math.max.apply(null,t),i=t.findIndex(function(t){return t===e}),o=t.map(function(t,o){return o===i+1?Math.min(e/t,1.5):1});return{topFontSize:void 0,topHeight:void 0,topWidth:void 0,fontSizeList:new Array(5).fill(void 0),wordRatio:[1].concat(o)}},p=null,g=1;t.forEach(function(e,i){if(e.getContext&&e.getContext("2d")&&(p=e,g=f(e.getContext("2d"))),"string"==typeof e){if(t[i]=document.getElementById(e),!t[i])throw"The element id specified is not found."}else if(!e.tagName&&!e.appendChild)throw"You must pass valid HTML elements, or ID of the element."});var v={list:[],fontFamily:'"Trebuchet MS", "Heiti TC", "微軟正黑體", "Arial Unicode MS", "Droid Fallback Sans", sans-serif',fontWeight:"bold",color:"random-dark",minSize:0,weightFactor:1,clearCanvas:!0,backgroundColor:"#fff",gridSize:8,drawOutOfBound:!1,origin:null,drawMask:!1,maskColor:"rgba(255,0,0,0.3)",maskGapWidth:.3,wait:0,abortThreshold:0,abort:function(){},minRotation:-Math.PI/2,maxRotation:Math.PI/2,rotationSteps:0,shuffle:!0,rotateRatio:.1,shape:"circle",ellipticity:.65,classes:null,hover:null,click:null,cursorWhenHover:"pointer",mouseout:null,topN:5,autoFontSize:!1,autoRatio:.8,enableSquareAdaptor:!1},w=this;if(w.words=[],w.elements=t,e)for(var x in e)x in v&&(v[x]=e[x]);if("function"!=typeof v.weightFactor){var b=v.weightFactor;v.weightFactor=function(t){return t*b}}if("function"!=typeof v.shape)switch(v.shape){case"circle":default:v.shape="circle";break;case"cardioid":v.shape=function(t){return 1-Math.sin(t)};break;case"diamond":v.shape=function(t){var e=t%(2*Math.PI/4);return 1/(Math.cos(e)+Math.sin(e))};break;case"square":v.shape=function(t){return Math.min(1/Math.abs(Math.cos(t)),1/Math.abs(Math.sin(t)))};break;case"triangle-forward":v.shape=function(t){var e=t%(2*Math.PI/3);return 1/(Math.cos(e)+Math.sqrt(3)*Math.sin(e))};break;case"triangle":case"triangle-upright":v.shape=function(t){var e=(t+3*Math.PI/2)%(2*Math.PI/3);return 1/(Math.cos(e)+Math.sqrt(3)*Math.sin(e))};break;case"pentagon":v.shape=function(t){var e=(t+.955)%(2*Math.PI/5);return 1/(Math.cos(e)+.726543*Math.sin(e))};break;case"star":v.shape=function(t){var e=(t+.955)%(2*Math.PI/10);return(t+.955)%(2*Math.PI/5)-2*Math.PI/10>=0?1/(Math.cos(2*Math.PI/10-e)+3.07768*Math.sin(2*Math.PI/10-e)):1/(Math.cos(e)+3.07768*Math.sin(e))}}v.gridSize=Math.max(Math.floor(v.gridSize),4);var y,_,S,M,C,k,I,z,F,T,E=v.gridSize,O=E-v.maskGapWidth,P=Math.abs(v.maxRotation-v.minRotation),R=Math.abs(Math.floor(v.rotationSteps)),A=Math.min(v.maxRotation,v.minRotation),L=m();switch(v.color){case"random-dark":T=function(){return n(10,50)};break;case"random-light":T=function(){return n(50,90)};break;default:"function"==typeof v.color&&(T=v.color)}var B;"function"==typeof v.fontWeight&&(B=v.fontWeight);var W=null;"function"==typeof v.classes&&(W=v.classes);var j,D=!1,H=[],N=function(t){var e,i,o=t.currentTarget,a=o.getBoundingClientRect();t.touches?(e=t.touches[0].clientX,i=t.touches[0].clientY):(e=t.clientX,i=t.clientY);var n=e-a.left,r=i-a.top,s=Math.floor(n*(o.width/a.width/g||1)/E),l=Math.floor(r*(o.height/a.height/g||1)/E);return H[s][l]},q=function(t){v.mouseout(t)},X=function(t){var e=N(t);if(j!==e){if(j=e,!e)return v.hover(void 0,void 0,t),void(t.target.style.cursor="default");"pointer"===v.cursorWhenHover&&(t.target.style.cursor="pointer"),v.hover(e.item,e.dimension,t)}},Y=function(t){var e=N(t);e&&(v.click(e.item,e.dimension,t,e.index),t.preventDefault())},J=[],G=function(t){if(J[t])return J[t];var e=8*t,i=e,o=[];for(0===t&&o.push([M[0],M[1],0]);i--;){var a=1;"circle"!==v.shape&&(a=v.shape(i/e*2*Math.PI)),o.push([M[0]+t*a*Math.cos(-i/e*2*Math.PI),M[1]+t*a*Math.sin(-i/e*2*Math.PI)*v.ellipticity,i/e*2*Math.PI])}return J[t]=o,o},Q=function(){return v.abortThreshold>0&&(new Date).getTime()-F>v.abortThreshold},U=function(){return 0===v.rotateRatio?0:Math.random()>v.rotateRatio?0:0===P?A:R>0?A+Math.floor(Math.random()*R)*P/(R-1):A+Math.random()*P},$=function(t,e,i,o,a){var n=!1,r=a?a*v.autoRatio:v.weightFactor(e);if(r<=v.minSize)return!1;var l=1;r<s&&(l=function(){for(var t=2;t*r<s;)t+=2;return t}());var h;h=B?B(t,e,r):v.fontWeight;var c=document.createElement("canvas"),f=c.getContext("2d",{willReadFrequently:!0});f.font=h+" "+(r*l).toString(10)+"px "+v.fontFamily;var d=f.measureText(t).width/l,u=Math.max(r*l,f.measureText("m").width,f.measureText("Ｗ").width)/l,m=o?d+2*u:d,p=o?3*u:u,g=Math.ceil(m/E),w=Math.ceil(p/E);m=g*E,p=w*E;var x=-d/2,b=.4*-u,y=Math.ceil((m*Math.abs(Math.sin(i))+p*Math.abs(Math.cos(i)))/E),_=Math.ceil((m*Math.abs(Math.cos(i))+p*Math.abs(Math.sin(i)))/E),S=_*E,M=y*E;c.setAttribute("width",S),c.setAttribute("height",M),n&&(document.body.appendChild(c),f.save()),f.scale(1/l,1/l),f.translate(S*l/2,M*l/2),f.rotate(-i),f.font=h+" "+(r*l).toString(10)+"px "+v.fontFamily,f.fillStyle="#000",f.textBaseline="middle",f.fillText(t,x*l,(b+.5*r)*l);var C=f.getImageData(0,0,S,M).data;if(Q())return!1;n&&(f.strokeRect(x*l,b,d*l,u*l),f.restore());for(var k,I,z,F=[],T=_,O=[y/2,_/2,y/2,_/2];T--;)for(k=y;k--;){z=E;t:{for(;z--;)for(I=E;I--;)if(C[4*((k*E+z)*S+(T*E+I))+3]){F.push([T,k]),O[3]=Math.min(T,O[3]),O[0]=Math.min(k,O[0]),O[1]=Math.max(T,O[1]),O[2]=Math.max(k,O[2]),n&&(f.fillStyle="rgba(255, 0, 0, 0.5)",f.fillRect(T*E,k*E,E-.5,E-.5));break t}n&&(f.fillStyle="rgba(0, 0, 255, 0.5)",f.fillRect(T*E,k*E,E-.5,E-.5))}}return n&&(f.fillStyle="rgba(0, 255, 0, 0.5)",f.fillRect(O[3]*E,O[0]*E,(O[1]-O[3]+1)*E,(O[2]-O[0]+1)*E)),{mu:l,occupied:F,bounds:O,gw:_,gh:y,fillTextOffsetX:x,fillTextOffsetY:b,fillTextWidth:d,fillTextHeight:u,fontSize:r}},K=function(t,e){switch(e){case"leftTop":return{x:0,y:0};case"leftBottom":return{x:0,y:t.gh};case"rightTop":return{x:t.gw,y:0};case"rightbottom":return{x:t.gw,y:t.gh};default:return{x:t.gw/2,y:t.gh/2}}},V=function(t,i,o,a,n){for(var r=n.length,s=e.enableSquareAdaptor?1:0;r--;){var l=t+n[r][0],h=i+n[r][1];if(l>=_-s||h>=S-s||l<0||h<0){if(!v.drawOutOfBound)return!1}else if(!y[l][h])return!1}return!0};w.drawItem=function(t,e){t&&(e?et(t.gx,t.gy,t.info,t.word,t.weight,t.distance,t.theta,t.rotateDeg,t.attributes,t.i,t.highlight):ot(t.gx,t.gy,t.gw,t.gh,t.info,t.item,t.i))};var Z=function(t,e,i,o,a,n,r,s,l){t.beginPath(0),t.save(),t.rotate(l),t.fillStyle=r,t.fillRect(e,i,o,a),t.rect(e,i,o,a),t.lineWidth="1",t.strokeStyle=s,t.stroke(),t.restore()},tt=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=/^#([0-9a-fA-f]{3}|[0-9a-fA-f]{6})$/,o=t.toLowerCase();if(o&&i.test(o)){if(4===o.length){for(var a="#",n=1;n<4;n+=1)a+=o.slice(n,n+1).concat(o.slice(n,n+1));o=a}for(var r=[],s=1;s<7;s+=2)r.push(parseInt("0x"+o.slice(s,s+2)));return"rgba("+r.join(",")+","+e+")"}return o.startsWith("rgba")?o.split(",").map(function(t,e){return 3===e&&(t=" 0.2)"),t}).join(","):o},et=function(i,a,n,r,s,l,h,c,f,d,u){var m,p=n.fontSize;m=T?T(r,s,p,l,h):v.color;var g;g=B?B(r,s,p):v.fontWeight;var w;w=W?W(r,s,p):v.classes;var x,b=n.bounds;x={x:(i+b[3])*E,y:(a+b[0])*E,w:(b[1]-b[3]+1)*E,h:(b[2]-b[0]+1)*E};var y,_,S,M=!1,C="left";"[object Array]"===Object.prototype.toString.call(m)&&(y=m[d%m.length],m=y,"[object Array]"===Object.prototype.toString.call(y)&&(M=!0),M&&"[object Number]"!==Object.prototype.toString.call(y[y.length-1])&&(y[y.length]=0),C=0===y[y.length-1]?"top":"left"),S=JSON.parse(JSON.stringify(m)),t.forEach(function(t,s){if(t.getContext){var l=t.getContext("2d"),h=n.mu;if(l.save(),l.scale(1/h,1/h),l.font=g+" "+(p*h).toString(10)+"px "+v.fontFamily,M){var x=l.measureText(r).width;_=l.createLinearGradient("top"!==C?-x/2:0,"top"===C?-p/2:0,"top"!==C?x/2:0,"top"===C?p/2:0);for(var s=0;s<y.length-1;s++)_.addColorStop(s/(y.length-2),y[s]);m=_}var b=function(t){if(e.enableColorFading&&!M){var i=5,o=e.list.length/i,a=Math.floor(d/o)+1,n=Math.min(a*e.colorFadingLevel,1),r=e.enableOptimize&&d<e.optimizedWordNum?1:1-n;return tt(t,r)}return t};if(l.fillStyle=b(m),l.translate((i+n.gw/2)*E*h,(a+n.gh/2)*E*h),u){var S;if(M){S=l.createLinearGradient("top"!==C?-n.fillTextOffsetX*h-4/h/2:0,"top"===C?-n.fillTextOffsetY*h-4/h/2:0,"top"!==C?n.fillTextOffsetX*h-4/h/2:0,"top"===C?n.fillTextOffsetY*h-4/h/2:0);for(var s=0;s<y.length-1;s++)S.addColorStop(s/(y.length-2),tt(y[y.length-2-s],.2))}Z(l,n.fillTextOffsetX*h-2/h,n.fillTextOffsetY*h-2/h,l.measureText(r).width+4/h,p+4/h,4/h,M?S:tt(y?y:m,.2),M?y[0]:y?y:m,-c)}l.shadowColor=e.shadowColor,l.shadowOffsetX=e.shadowOffsetX,l.shadowOffsetY=e.shadowOffsetY,l.shadowBlur=e.shadowBlur,0!==c&&l.rotate(-c),l.textBaseline="middle",l.fillText(r,n.fillTextOffsetX*h,(n.fillTextOffsetY+.5*p)*h),l.restore()}else{M&&(m=y);var k=document.createElement("div"),I=document.createElement("span"),z="";z="rotate("+-c/Math.PI*180+"deg) ",1!==n.mu&&(z+="translateX(-"+n.fillTextWidth/4+"px) scale("+1/n.mu+")");var F=o({position:"absolute",display:"block",font:g+" "+p*n.mu+"px "+v.fontFamily,left:(i+n.gw/2)*E+n.fillTextOffsetX+"px",top:(a+n.gh/2)*E+n.fillTextOffsetY+"px",width:n.fillTextWidth+"px","box-sizing":"border-box","border-radius":"4px","border-style":"solid","border-width":"1px","border-color":"transparent",lineHeight:p+"px",whiteSpace:"nowrap",transform:z,webkitTransform:z,msTransform:z,transformOrigin:"50% 40%",webkitTransformOrigin:"50% 40%",msTransformOrigin:"50% 40%"},"font",g+" "+p*n.mu+"px "+v.fontFamily),T={display:"block",font:g+" "+p*n.mu+"px "+v.fontFamily,filter:"drop-shadow("+e.shadowOffsetX+"px "+e.shadowOffsetY+"px "+e.shadowBlur+"px "+e.shadowColor+")"};u&&(F=Object.assign(F,o({"border-color":M?m[0]:m,"border-style":"solid","border-width":"1px"},"border-color",M?m[0]:m)),M?F.backgroundImage="-webkit-linear-gradient("+C+","+m.filter(function(t,e){return e!=m.length-1}).map(function(t){return tt(t,.2)}).join(",")+")":F.backgroundColor=tt(m,.2)),m&&("[object Array]"===Object.prototype.toString.call(m)&&(T=Object.assign({webkitBackgroundClip:"text",webkitTextFillColor:"transparent",backgroundImage:"-webkit-linear-gradient("+C+","+m.filter(function(t,e){return e!=m.length-1}).join(",")+")"},T)),T.color=m),I.textContent=r;for(var O in F)k.style[O]=F[O];for(var O in T)I.style[O]=T[O];if(f)for(var P in f)I.setAttribute(P,f[P]);w&&(I.className+=w),k.appendChild(I),t.appendChild(k)}})},it=function(e,i,o,a,n,r){if(!(e>=_||i>=S||e<0||i<0)){if(y[e][i]=!1,o){var s=t[0].getContext("2d");s.fillRect(e*E,i*E,O,O)}D&&(H[e][i]={item:n,dimension:a,index:r})}},ot=function(e,i,o,a,n,r,s){var l,h=n.occupied,c=v.drawMask;c&&(l=t[0].getContext("2d"),l.save(),l.fillStyle=v.maskColor);var f;if(D){var d=n.bounds;f={x:(e+d[3])*E,y:(i+d[0])*E,w:(d[1]-d[3]+1)*E,h:(d[2]-d[0]+1)*E}}for(var u=h.length;u--;){var m=e+h[u][0],p=i+h[u][1];m>=_||p>=S||m<0||p<0||it(m,p,c,f,r,s)}c&&l.restore()},at=function(t){for(var e=0,i=0;i<t.length;i++){var o=t.charCodeAt(i);e+=o>=19968&&o<=40959?2:1}return e},nt=function(t){var e=at(t),i=[{characters:4,widthPercentage:.55},{characters:6,widthPercentage:.62},{characters:8,widthPercentage:.7}],o=null,a=1/0,n=!0,r=!1,s=void 0;try{for(var l,h=i[Symbol.iterator]();!(n=(l=h.next()).done);n=!0){var c=l.value,f=Math.abs(e-c.characters);f<a&&(a=f,o=c)}}catch(t){r=!0,s=t}finally{try{!n&&h.return&&h.return()}finally{if(r)throw s}}return o?o.widthPercentage:.75},rt=function(t,i){var o,a,n,r,s,h=i;Array.isArray(t)?(o=t[0],a=t[1],r=t[2]):(o=t.word,a=t.weight,n=t.attributes,r=t.highlight);var c=function(e){var i=U(),c=L.fontSizeList[h-1],f=e||c,d=$(o,a,i,!0,f);if(s=d.fontSize,!d)return!1;if(Q())return!1;if(!v.drawOutOfBound){var u=d.bounds;if(u[1]-u[3]+1>_||u[2]-u[0]+1>S)return!1}for(var m=z+1,p=function(e,s){var l=Math.floor(e[0]-d.gw/2),h=Math.floor(e[1]-d.gh/2),c=d.gw,f=d.gh;if(!V(l,h,c,f,d.occupied))return!1;var u={gx:l,gy:h,info:d,word:o,weight:a,distance:z-m,theta:e[2],attributes:n,item:t,i:s,highlight:r,rotateDeg:i};return w.words.push(u),u};m--;){var g=G(z-m);v.shuffle&&(g=[].concat(g),l(g));for(var x,b=0;b<g.length;b++){var y=p(g[b],h);if(y){x=y;break}}if(x)return x}return!1},f=c();if(f)return f;if(!(e.autoFontSize&&h>=v.topN))return!1;if(s<=e.minFontSize)return!1;for(;!f;)if(f=c(s))return e.maxFontSize=s,f},st=function(t,i){var o,a,n,r,s,l=[M[0],M[1],0],h=[l].concat(k.map(function(t){var e=C[t];return[e[0],e[1],0]})),c=i;Array.isArray(t)?(o=t[0],a=t[1],r=t[2]):(o=t.word,a=t.weight,n=t.attributes,r=t.highlight);var f=function(i,l){var h=U(),f=function(){var t=Math.min(_*E,S*E),i=(L.topHeight||0,Math.min(t,t)),o=L.fontSizeList[c-1]*(L.wordRatio[c]||1),a=o||Math.ceil(i);return 0===c?Math.ceil(e.maxFontSize):a},d=l?l:f(),u=$(o,a,h,!1,d);if(s=u.fontSize,!u)return!1;if(Q())return!1;if(!v.drawOutOfBound){var m=u.bounds;if(m[1]-m[3]+1>_||m[2]-m[0]+1>S)return!1}var p=z+1,g=function(e,i){var s=k[i-1],l=K(u,s),h=Math.floor(e[0]-l.x),c=Math.floor(e[1]-l.y),f=u.gw,d=u.gh,m=nt(o),g=function(t,e){switch(e){case 0:return!0;default:return t/Math.min(_,S)<=m}};if(!V(h,c,f,d,u.occupied)||!g(f,i))return!1;var v={gx:h,gy:c,info:u,word:o,weight:a,distance:z-p,theta:e[2],attributes:n,item:t,i:i,highlight:r,rotateDeg:0};return w.words.push(v),v},x=g(i,c);return!!x&&x},d=h[c],u=f(d);if(u)return e.maxFontSize=0===c?e.maxFontSize:s,u;if(s<=e.minFontSize)return!1;for(;!u;)if(u=f(d,s))return e.maxFontSize=0===c?e.maxFontSize:s,u},lt=function(e,i,o){return i?!t.some(function(t){var a=document.createEvent("CustomEvent");return a.initCustomEvent(e,!0,i,o||{}),!t.dispatchEvent(a)},this):void t.forEach(function(t){var a=document.createEvent("CustomEvent");a.initCustomEvent(e,!0,i,o||{}),t.dispatchEvent(a)},this)},ht=function(t){var e=document.createElement("canvas"),i=e.getContext("2d");i.fillStyle=t,i.fillRect(0,0,1,1);var o=i.getImageData(0,0,1,1).data;return e=i=void 0,o},ct=function(){var o=i;if(o.getContext)_=Math.ceil(o.width/E),S=Math.ceil(o.height/E);else{var n=o.getBoundingClientRect();_=Math.ceil(n.width/E),S=Math.ceil(n.height/E)}if(lt("wordcloudstart",!0)){M=v.origin?[v.origin[0]/E,v.origin[1]/E]:[_/2,S/2];var r=Math.abs(Math.floor((_-S)/2)),s=_>S?[r,0]:[0,r],l=_>S?[r,S-1]:[0,r+_-1],d=_>S?[r+S-1,0]:[_-1,r],g=_>S?[r+S-1,S-1]:[_-1,r+_-1];k=["leftTop","leftBottom","rightTop","rightbottom"],C={leftTop:s,leftBottom:l,rightTop:d,rightbottom:g},I=e.maxFontSize,z=Math.floor(Math.sqrt(_*_+S*S)),y=[],L=m();var x=u(),b=Math.max.apply(null,x),T=x.findIndex(function(t){return t===b});0===T&&a(x)>20&&(k=["leftTop","leftBottom","rightbottom","rightTop"]);var O,P,R,A,B=e.maxFontSize;if(t.forEach(function(t){if(t.getContext){var e=t.getContext("2d");e.fillStyle=v.backgroundColor,e.clearRect(0,0,_*(E+1),S*(E+1)),e.fillRect(0,0,_*(E+1),S*(E+1))}else t.textContent="",t.style.position="relative"}),!o.getContext||v.clearCanvas)for(O=_;O--;)for(y[O]=[],P=S;P--;)y[O][P]=!0;else{var W=ht("#ffffff"),N=o.getContext("2d").getImageData(0,0,_*E,S*E).data;O=_;for(var J,G;O--;)for(y[O]=[],P=S;P--;){G=E;t:for(;G--;)for(J=E;J--;)for(R=4;R--;)if(N[4*((P*E+G)*_*E+(O*E+J))+R]!==W[R]){y[O][P]=!1;break t}y[O][P]!==!1&&(y[O][P]=!0)}N=W=void 0}if(c(),h()&&(w.maskCanvas=i),e.enableSquareAdaptor&&0!==r)for(var R=0;R<_;R++)for(var U=0;U<S;U++)_>S?(R<r||R>r+S-1)&&(y[R][U]=!1):_<S&&(U<r||U>r+_-1)&&(y[R][U]=!1);if("circle"===e.shape)for(var $=Math.min(_,S)/2,R=0;R<_;R++)for(var U=0;U<S;U++)(R-_/2)*(R-_/2)+(U-S/2)*(U-S/2)>$*$&&(y[R][U]=!1);if(A=JSON.parse(JSON.stringify(y)),v.hover||v.click){for(D=!0,O=_+1;O--;)H[O]=[];var K=function(t){t.preventDefault()};t.forEach(function(t){v.hover&&(t.addEventListener("mousemove",X),t.addEventListener("mouseout",q)),v.click&&(t.addEventListener("click",Y),t.addEventListener("touchstart",Y),t.addEventListener("touchend",K),t.style.webkitTapHighlightColor="rgba(0, 0, 0, 0)"),t.addEventListener("wordcloudstart",function e(){t.removeEventListener("wordcloudstart",e),t.removeEventListener("mousemove",X),t.removeEventListener("mouseout",q),t.removeEventListener("click",Y),t.removeEventListener("touchstart",Y),t.removeEventListener("touchend",K),j=void 0})})}R=0;var V,Z;0!==v.wait?(V=window.setTimeout,Z=window.clearTimeout):(V=window.setImmediate,Z=window.clearImmediate);var tt=function(e,i){t.forEach(function(t){t.addEventListener(e,i)},this)},et=function(e,i){t.forEach(function(t){t.removeEventListener(e,i)},this)},it=function t(){et("wordcloudstart",t),Z(ot)};tt("wordcloudstart",it);var ot=V(function t(){if(R>=v.list.length)return Z(ot),lt("wordcloudstop",!1),void et("wordcloudstart",it);F=(new Date).getTime();var i;v.enableSquareAdaptor&&R<5?(i=st(v.list[R],R),i&&(0===R?(L.topWidth=i.info.fillTextWidth,L.topHeight=i.info.fillTextHeight):L.fontSizeList[R]=i.info.fontSize)):i||(i=rt(v.list[R],R));var o=e.enableSquareAdaptor?Math.min(30,e.list.length):v.topN+1;if(i&&R===o-1)for(var a=0;a<o;a++)w.drawItem(w.words[a],!0);else R>=o&&w.drawItem(i,!0);R<=o-1&&!i?(B*=v.autoRatio,e.maxFontSize=B,I=e.maxFontSize,w.words=[],y=JSON.parse(JSON.stringify(A)),R=0):R++,w.drawItem(i);var n=!lt("wordclouddrawn",!0,{item:v.list[R],drawn:i&&!0});return Q()||n?(Z(ot),v.abort(),lt("wordcloudabort",!1),lt("wordcloudstop",!1),void et("wordcloudstart",it)):void(ot=V(t,v.wait))},v.wait);if(p){var at=p.getContext("2d"),nt=f(at);p.width=p.width*nt,p.height=p.height*nt,at.scale(nt,nt),h()&&(at.globalCompositeOperation="source-over",at.drawImage(i,0,0))}}};return ct(),this}};h.prototype.highlight=function(t,e){var i=this;i.elements.forEach(function(o,a){o.getContext?o.getContext("2d").clearRect(0,0,o.width,o.height):o.innerHTML="",i.words.forEach(function(o){e||(o.highlight=!1),o.i===t&&(o.highlight=!0),i.drawItem(o,!0)});var n=o.getContext("2d");n&&i.maskCanvas&&(n.globalCompositeOperation="source-over",n.drawImage(i.maskCanvas,0,0))})},h.prototype.downplay=function(t,e){var i=this;i.elements.forEach(function(e,o){e.getContext?e.getContext("2d").clearRect(0,0,e.width,e.height):e.innerHTML="",i.words.forEach(function(e){e.i===t&&(e.highlight=!1),i.drawItem(e,!0)});var a=e.getContext("2d");a&&i.maskCanvas&&(a.globalCompositeOperation="source-over",a.drawImage(i.maskCanvas,0,0))})},h.isSupported=r,h.minFontSize=s,i.WordCloud=h,a=[],n=function(){return h}.apply(e,a),!(void 0!==n&&(t.exports=n))}(this)}).call(window)}])});