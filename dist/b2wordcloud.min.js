!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.B2wordcloud=e():t.B2wordcloud=e()}(this,function(){return function(t){function e(a){if(i[a])return i[a].exports;var o=i[a]={exports:{},id:a,loaded:!1};return t[a].call(o.exports,o,o.exports,e),o.loaded=!0,o.exports}var i={};return e.m=t,e.c=i,e.p="",e(0)}([function(t,e,i){"use strict";function a(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){var i;for(i in e)t[i]=t[i]&&"[object Object]"===t[i].toString()?o(t[i],e[i]):t[i]=e[i];return t}function n(t,e){var i=document.createElement("canvas").getContext("2d");i.fillStyle="#ffffff",i.fillRect(0,0,1,1);var a=i.getImageData(0,0,1,1).data,o=document.createElement("canvas");o.width=e.width,o.height=e.height;var n=o.getContext("2d");n.drawImage(t,0,0,t.width,t.height,0,0,o.width,o.height);for(var r=n.getImageData(0,0,e.width,e.height),s=n.createImageData(r),l=0;l<r.data.length;l+=4)r.data[l+3]>128?(s.data[l]=a[0],s.data[l+1]=a[1],s.data[l+2]=a[2],s.data[l+3]=a[3]):(s.data[l]=a[0],s.data[l+1]=a[1],s.data[l+2]=a[2],s.data[l+3]=a[3]?a[3]-1:0);n.putImageData(s,0,0),n=e.getContext("2d"),n.drawImage(o,0,0),o=n=r=s=i=a=void 0}Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(t,e){for(var i=0;i<e.length;i++){var a=e[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}return function(e,i,a){return i&&t(e.prototype,i),a&&t(e,a),e}}(),s=i(1),l=function(t){var e=t.backingStorePixelRatio||t.webkitBackingStorePixelRatio||t.mozBackingStorePixelRatio||t.msBackingStorePixelRatio||t.oBackingStorePixelRatio||t.backingStorePixelRatio||1;return(window.devicePixelRatio||1)/e*4},h=e.B2wordcloud=function(){function t(e,i){a(this,t),this._wrapper=e,this._wrapper.style.position="relative",this._container=null,this._tooltip=null,this._options=o({renderer:"canvas",effect:"equal",tooltip:{show:!0,formatter:null},clearCanvas:!i.maskImage},i),this._wordcloud2=null,this._maskCanvas=null,this._shapeCanvas=null,this._tempCanvas=null,this._maskImg=null,this._init(),this._cacheHoverParams={item:null,dimension:null,event:null}}return r(t,[{key:"_init",value:function(){this._sortList(this._options),this._initContainer(),this._setOptions()}},{key:"_sortList",value:function(t){t.list=t.list.sort(function(t,e){return e[1]-t[1]})}},{key:"_setDefaultFontSize",value:function(t){t.autoFontSize?(t.enableSquareAdaptor?t.maxFontSize=this._wrapper.clientWidth:t.maxFontSize=this._options.clientWidth?Math.min(this._options.clientWidth,400):400,t.minFontSize="number"==typeof t.minFontSize?t.minFontSize:10):(t.maxFontSize="number"==typeof t.maxFontSize?t.maxFontSize:36,t.minFontSize="number"==typeof t.minFontSize?t.minFontSize:10)}},{key:"_initContainer",value:function(){this._maskCanvas=document.createElement("canvas"),this._setCanvasSize(this._maskCanvas),"div"===this._options.renderer?(this._container=document.createElement("div"),this._container.style.width="100%",this._container.style.height="100%",this._createTempCanvas()):"canvas"===this._options.renderer&&(this._container=document.createElement("canvas"),this._setCanvasSize()),this._wrapper.appendChild(this._container)}},{key:"_createTempCanvas",value:function(){this._tempCanvas=document.createElement("canvas"),this._setCanvasSize(this._tempCanvas)}},{key:"_initTooltip",value:function(){this._tooltip||(this._tooltip=document.createElement("div"),this._tooltip.className=this._options.tooltip.className||"",this._tooltip.style.backgroundColor=this._options.tooltip.backgroundColor||"rgba(0,0,0,0.8)",this._tooltip.style.color="#fff",this._tooltip.style.padding="5px",this._tooltip.style.borderRadius="5px",this._tooltip.style.fontSize="13px",this._tooltip.style.lineHeight="1.4",this._tooltip.style.webkitTransition="left 0.2s, top 0.2s",this._tooltip.style.transition="left 0.2s, top 0.2s",this._tooltip.style.position="absolute",this._tooltip.style.whiteSpace="nowrap",this._tooltip.style.zIndex="999",this._tooltip.style.display="none"),document.body.appendChild(this._tooltip)}},{key:"_setCanvasSize",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._container,e=this._options.clientWidth?this._options.clientWidth:this._wrapper.clientWidth,i=this._options.clientHeight?this._options.clientHeight:this._wrapper.clientHeight;t.width=e,t.height=i,t.style.width=e+"px",t.style.height=i+"px"}},{key:"_setOptions",value:function(){var t=this;if(this._setDefaultFontSize(this._options),!this._options.weightFactor&&this._fixWeightFactor(this._options),this._options.tooltip.show){this._initTooltip();var e=void 0,i=void 0,a=void 0,o=void 0,n=this._options.hover,r=this._options.mouseout;this._options.mouseout=function(e){r&&r(e),t._cacheHoverParams.item||(t._tooltip.style.display="none");var i=e.toElement;i&&i===t._tooltip&&i.addEventListener("mouseleave",function t(){i.style.display="none",i.removeEventListener("mouseleave",t)})},this._options.hover=function(r,s,l){if(t._cacheHoverParams.item=r,t._cacheHoverParams.dimension=s,t._cacheHoverParams.event=l,n&&n(r,s,l),r){var h=r[0]+": "+r[1];"[object Function]"===Object.prototype.toString.call(t._options.tooltip.formatter)&&(h=t._options.tooltip.formatter(r)),t._tooltip.style.display="block",e=t._tooltip.clientWidth,i=t._tooltip.clientHeight,a=i+15,o=e/2+5;var c=l.pageY-a,d=l.pageX-o;if("function"==typeof t._options.tooltip.position){var f=t._options.tooltip.position(r,s,l);f&&(c=f.top,d=f.left)}t._tooltip.style.position="absolute",t._tooltip.style.top=c+"px",t._tooltip.style.left=d+"px",t._tooltip.innerHTML=h}else t._tooltip.style.display="none"}}this._options&&this._options.maskImage?this._maskImage():this._render()}},{key:"_maskImage",value:function(){var t=this,e=window.document.createElement("img");e.crossOrigin="Anonymous",e.src=this._options.maskImage,e.onload=function(){t._maskImg=e,t._shapeCanvas=document.createElement("canvas");var i=t._shapeCanvas.getContext("2d"),a=l(i);t._shapeCanvas.style.width=e.width+"px",t._shapeCanvas.style.height=e.height+"px",t._shapeCanvas.width=e.width*a,t._shapeCanvas.height=e.height*a,i.imageSmoothingEnabled=!1,i.imageSmoothingQuality="high",i.drawImage(e,0,0,e.width*a,e.height*a),i.scale(a,a);for(var o=i.getImageData(0,0,t._shapeCanvas.width,t._shapeCanvas.height),n=i.createImageData(o),r=0;r<o.data.length;r+=4){var s=o.data[r]+o.data[r+1]+o.data[r+2],h=o.data[r+3];h<128||s>384?(n.data[r]=n.data[r+1]=n.data[r+2]=255,n.data[r+3]=0):(n.data[r]=n.data[r+1]=n.data[r+2]=0,n.data[r+3]=255)}i.putImageData(n,0,0),t._render()}}},{key:"_render",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._maskImg&&n(this._shapeCanvas,this._maskCanvas),this._wordcloud2=new s("canvas"===this._options.renderer?this._container:[this._tempCanvas,this._container],this._options,this._maskCanvas,t)}},{key:"_fixWeightFactor",value:function(t){if(t.list&&t.list.length>0){var e=t.list[t.list.length-1][1],i=t.list[0][1],i=t.enableSquareAdaptor&&t.list[1]&&t.list[1][1]?t.list[1][1]:t.list[0][1];i>e?t.weightFactor=function(a){if("linerMap"===t.effect){var o=i-e,n=(t.maxFontSize-t.minFontSize)/(t.topN||5);return 0===o?0===n?t.minFontSize:(t.minFontSize+t.maxFontSize)/2:a===e?t.minFontSize:a===i?n+t.minFontSize:(a-e)/o*n+t.minFontSize}var r="number"==typeof t.fontSizeFactor?t.fontSizeFactor:1/(t.topN||5),s=(t.maxFontSize-t.minFontSize)/(Math.pow(i,r)-Math.pow(e,r)),l=t.maxFontSize-s*Math.pow(i,r);return Math.ceil(s*Math.pow(a,r)+l)}:t.weightFactor=function(e){return t.maxFontSize}}}},{key:"dispatchAction",value:function(t){switch(t.type){case"highlight":this._wordcloud2.highlight(t.dataIndex,t.keepAlive);break;case"downplay":this._wordcloud2.downplay(t.dataIndex,t.keepAlive)}}}]),t}();t.exports=h},function(t,e,i){function a(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}var o,n;(function(){/*!
	   * wordcloud2.js
	   * http://timdream.org/wordcloud2.js/
	   *
	   * Copyright 2011 - 2013 Tim Chien
	   * Released under the MIT license
	   */
"use strict";window.setImmediate||(window.setImmediate=function(){return window.msSetImmediate||window.webkitSetImmediate||window.mozSetImmediate||window.oSetImmediate||function(){if(!window.postMessage||!window.addEventListener)return null;var t=[void 0],e="zero-timeout-message",i=function(i){var a=t.length;return t.push(i),window.postMessage(e+a.toString(36),"*"),a};return window.addEventListener("message",function(i){if("string"==typeof i.data&&i.data.substr(0,e.length)===e){i.stopImmediatePropagation();var a=parseInt(i.data.substr(e.length),36);t[a]&&(t[a](),t[a]=void 0)}},!0),window.clearImmediate=function(e){t[e]&&(t[e]=void 0)},i}()||function(t){window.setTimeout(t,0)}}()),window.clearImmediate||(window.clearImmediate=function(){return window.msClearImmediate||window.webkitClearImmediate||window.mozClearImmediate||window.oClearImmediate||function(t){window.clearTimeout(t)}}()),function(i){var r=function(){var t=document.createElement("canvas");if(!t||!t.getContext)return!1;var e=t.getContext("2d");return!!e&&(!!e.getImageData&&(!!e.fillText&&(!!Array.prototype.some&&!!Array.prototype.push)))}(),s=function(){if(r){for(var t,e,i=document.createElement("canvas").getContext("2d"),a=20;a;){if(i.font=a.toString(10)+"px sans-serif",i.measureText("Ｗ").width===t&&i.measureText("m").width===e)return a+1;t=i.measureText("Ｗ").width,e=i.measureText("m").width,a--}return 0}}(),l=function(t){for(var e,i,a=t.length;a;e=Math.floor(Math.random()*a),i=t[--a],t[a]=t[e],t[e]=i);return t},h=function(t,e,i){function o(t,e){return"hsl("+(360*Math.random()).toFixed()+","+(30*Math.random()+70).toFixed()+"%,"+(Math.random()*(e-t)+t).toFixed()+"%)"}if(r){Array.isArray(t)||(t=[t]);var n=function(){return!(!u.backgroundColor||"transparent"===u.backgroundColor)},h=function(){for(var t=i.getContext("2d"),e=t.getImageData(0,0,i.width,i.height),a=et(u.backgroundColor),o=et("#ffffff"),n=0;n<e.data.length;n+=4){for(var r=0,s=!0;r<4;){if(e.data[n+r]!==o[r]){s=!1;break}r++}s&&(e.data[n]=a[0],e.data[n+1]=a[1],e.data[n+2]=a[2],e.data[n+3]=a[3])}t.putImageData(e,0,0)},c=function(t){var e=t.backingStorePixelRatio||t.webkitBackingStorePixelRatio||t.mozBackingStorePixelRatio||t.msBackingStorePixelRatio||t.oBackingStorePixelRatio||t.backingStorePixelRatio||1;return(window.devicePixelRatio||1)/e*2},d=null,f=1;t.forEach(function(e,i){if(e.getContext&&e.getContext("2d")&&(d=e,f=c(e.getContext("2d"))),"string"==typeof e){if(t[i]=document.getElementById(e),!t[i])throw"The element id specified is not found."}else if(!e.tagName&&!e.appendChild)throw"You must pass valid HTML elements, or ID of the element."});var u={list:[],fontFamily:'"Trebuchet MS", "Heiti TC", "微軟正黑體", "Arial Unicode MS", "Droid Fallback Sans", sans-serif',fontWeight:"bold",color:"random-dark",minSize:0,weightFactor:1,clearCanvas:!0,backgroundColor:"#fff",gridSize:8,drawOutOfBound:!1,origin:null,drawMask:!1,maskColor:"rgba(255,0,0,0.3)",maskGapWidth:.3,wait:0,abortThreshold:0,abort:function(){},minRotation:-Math.PI/2,maxRotation:Math.PI/2,rotationSteps:0,shuffle:!0,rotateRatio:.1,shape:"circle",ellipticity:.65,classes:null,hover:null,click:null,cursorWhenHover:"pointer",mouseout:null,topN:5,autoFontSize:!1,autoRatio:.8,enableSquareAdaptor:!1},m=this;if(m.words=[],m.elements=t,e)for(var p in e)p in u&&(u[p]=e[p]);if("function"!=typeof u.weightFactor){var g=u.weightFactor;u.weightFactor=function(t){return t*g}}if("function"!=typeof u.shape)switch(u.shape){case"circle":default:u.shape="circle";break;case"cardioid":u.shape=function(t){return 1-Math.sin(t)};break;case"diamond":u.shape=function(t){var e=t%(2*Math.PI/4);return 1/(Math.cos(e)+Math.sin(e))};break;case"square":u.shape=function(t){return Math.min(1/Math.abs(Math.cos(t)),1/Math.abs(Math.sin(t)))};break;case"triangle-forward":u.shape=function(t){var e=t%(2*Math.PI/3);return 1/(Math.cos(e)+Math.sqrt(3)*Math.sin(e))};break;case"triangle":case"triangle-upright":u.shape=function(t){var e=(t+3*Math.PI/2)%(2*Math.PI/3);return 1/(Math.cos(e)+Math.sqrt(3)*Math.sin(e))};break;case"pentagon":u.shape=function(t){var e=(t+.955)%(2*Math.PI/5);return 1/(Math.cos(e)+.726543*Math.sin(e))};break;case"star":u.shape=function(t){var e=(t+.955)%(2*Math.PI/10);return(t+.955)%(2*Math.PI/5)-2*Math.PI/10>=0?1/(Math.cos(2*Math.PI/10-e)+3.07768*Math.sin(2*Math.PI/10-e)):1/(Math.cos(e)+3.07768*Math.sin(e))}}u.gridSize=Math.max(Math.floor(u.gridSize),4);var v,w,x,b,y,_,S,C,M,k=u.gridSize,I=k-u.maskGapWidth,F=Math.abs(u.maxRotation-u.minRotation),z=Math.abs(Math.floor(u.rotationSteps)),T=Math.min(u.maxRotation,u.minRotation);switch(u.color){case"random-dark":M=function(){return o(10,50)};break;case"random-light":M=function(){return o(50,90)};break;default:"function"==typeof u.color&&(M=u.color)}var E;"function"==typeof u.fontWeight&&(E=u.fontWeight);var O=null;"function"==typeof u.classes&&(O=u.classes);var P,R=!1,A=[],L=function(t){var e,i,a=t.currentTarget,o=a.getBoundingClientRect();t.touches?(e=t.touches[0].clientX,i=t.touches[0].clientY):(e=t.clientX,i=t.clientY);var n=e-o.left,r=i-o.top,s=Math.floor(n*(a.width/o.width/f||1)/k),l=Math.floor(r*(a.height/o.height/f||1)/k);return A[s][l]},W=function(t){u.mouseout(t)},j=function(t){var e=L(t);if(P!==e){if(P=e,!e)return u.hover(void 0,void 0,t),void(t.target.style.cursor="default");"pointer"===u.cursorWhenHover&&(t.target.style.cursor="pointer"),u.hover(e.item,e.dimension,t)}},B=function(t){var e=L(t);e&&(u.click(e.item,e.dimension,t,e.index),t.preventDefault())},D=[],H=function(t){if(D[t])return D[t];var e=8*t,i=e,a=[];for(0===t&&a.push([b[0],b[1],0]);i--;){var o=1;"circle"!==u.shape&&(o=u.shape(i/e*2*Math.PI)),a.push([b[0]+t*o*Math.cos(-i/e*2*Math.PI),b[1]+t*o*Math.sin(-i/e*2*Math.PI)*u.ellipticity,i/e*2*Math.PI])}return D[t]=a,a},N=function(){return u.abortThreshold>0&&(new Date).getTime()-C>u.abortThreshold},q=function(){return 0===u.rotateRatio?0:Math.random()>u.rotateRatio?0:0===F?T:z>0?T+Math.floor(Math.random()*z)*F/(z-1):T+Math.random()*F},X=function(t,e,i,a,o){var n=!1,r=o?o*u.autoRatio:u.weightFactor(e);if(r<=u.minSize)return!1;var l=1;r<s&&(l=function(){for(var t=2;t*r<s;)t+=2;return t}());var h;h=E?E(t,e,r):u.fontWeight;var c=document.createElement("canvas"),d=c.getContext("2d",{willReadFrequently:!0});d.font=h+" "+(r*l).toString(10)+"px "+u.fontFamily;var f=d.measureText(t).width/l,m=Math.max(r*l,d.measureText("m").width,d.measureText("Ｗ").width)/l,p=a?f+2*m:f,g=a?3*m:m,v=Math.ceil(p/k),w=Math.ceil(g/k);p=v*k,g=w*k;var x=-f/2,b=.4*-m,y=Math.ceil((p*Math.abs(Math.sin(i))+g*Math.abs(Math.cos(i)))/k),_=Math.ceil((p*Math.abs(Math.cos(i))+g*Math.abs(Math.sin(i)))/k),S=_*k,C=y*k;c.setAttribute("width",S),c.setAttribute("height",C),n&&(document.body.appendChild(c),d.save()),d.scale(1/l,1/l),d.translate(S*l/2,C*l/2),d.rotate(-i),d.font=h+" "+(r*l).toString(10)+"px "+u.fontFamily,d.fillStyle="#000",d.textBaseline="middle",d.fillText(t,x*l,(b+.5*r)*l);var M=d.getImageData(0,0,S,C).data;if(N())return!1;n&&(d.strokeRect(x*l,b,f*l,m*l),d.restore());for(var I,F,z,T=[],O=_,P=[y/2,_/2,y/2,_/2];O--;)for(I=y;I--;){z=k;t:{for(;z--;)for(F=k;F--;)if(M[4*((I*k+z)*S+(O*k+F))+3]){T.push([O,I]),O<P[3]&&(P[3]=O),O>P[1]&&(P[1]=O),I<P[0]&&(P[0]=I),I>P[2]&&(P[2]=I),n&&(d.fillStyle="rgba(255, 0, 0, 0.5)",d.fillRect(O*k,I*k,k-.5,k-.5));break t}n&&(d.fillStyle="rgba(0, 0, 255, 0.5)",d.fillRect(O*k,I*k,k-.5,k-.5))}}return n&&(d.fillStyle="rgba(0, 255, 0, 0.5)",d.fillRect(P[3]*k,P[0]*k,(P[1]-P[3]+1)*k,(P[2]-P[0]+1)*k)),{mu:l,occupied:T,bounds:P,gw:_,gh:y,fillTextOffsetX:x,fillTextOffsetY:b,fillTextWidth:f,fillTextHeight:m,fontSize:r}},Y=function(t,e){switch(e){case 1:return{x:0,y:0};case 2:return{x:0,y:t.gh};case 3:return{x:t.gw,y:0};case 4:return{x:t.gw,y:t.gh};default:return{x:t.gw/2,y:t.gh/2}}},J=function(t,i,a,o,n){for(var r=n.length,s=e.enableSquareAdaptor?1:0;r--;){var l=t+n[r][0],h=i+n[r][1];if(l>=w-s||h>=x-s||l<0||h<0){if(!u.drawOutOfBound)return!1}else if(!v[l][h])return!1}return!0};m.drawItem=function(t,e){t&&(e?U(t.gx,t.gy,t.info,t.word,t.weight,t.distance,t.theta,t.rotateDeg,t.attributes,t.i,t.highlight):K(t.gx,t.gy,t.gw,t.gh,t.info,t.item,t.i))};var G=function(t,e,i,a,o,n,r,s,l){t.beginPath(0),t.save(),t.rotate(l),t.fillStyle=r,t.fillRect(e,i,a,o),t.rect(e,i,a,o),t.lineWidth="1",t.strokeStyle=s,t.stroke(),t.restore()},Q=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=/^#([0-9a-fA-f]{3}|[0-9a-fA-f]{6})$/,a=t.toLowerCase();if(a&&i.test(a)){if(4===a.length){for(var o="#",n=1;n<4;n+=1)o+=a.slice(n,n+1).concat(a.slice(n,n+1));a=o}for(var r=[],s=1;s<7;s+=2)r.push(parseInt("0x"+a.slice(s,s+2)));return"rgba("+r.join(",")+","+e+")"}return a.startsWith("rgba")?a.split(",").map(function(t,e){return 3===e&&(t=" 0.2)"),t}).join(","):a},U=function(i,o,n,r,s,l,h,c,d,f,m){var p,g=n.fontSize;p=M?M(r,s,g,l,h):u.color;var v;v=E?E(r,s,g):u.fontWeight;var w;w=O?O(r,s,g):u.classes;var x,b=n.bounds;x={x:(i+b[3])*k,y:(o+b[0])*k,w:(b[1]-b[3]+1)*k,h:(b[2]-b[0]+1)*k};var y,_,S,C=!1,I="left";"[object Array]"===Object.prototype.toString.call(p)&&(y=p[f%p.length],p=y,"[object Array]"===Object.prototype.toString.call(y)&&(C=!0),C&&"[object Number]"!==Object.prototype.toString.call(y[y.length-1])&&(y[y.length]=0),I=0===y[y.length-1]?"top":"left"),S=JSON.parse(JSON.stringify(p)),t.forEach(function(t,s){if(t.getContext){var l=t.getContext("2d"),h=n.mu;if(l.save(),l.scale(1/h,1/h),l.font=v+" "+(g*h).toString(10)+"px "+u.fontFamily,C){var x=l.measureText(r).width;_=l.createLinearGradient("top"!==I?-x/2:0,"top"===I?-g/2:0,"top"!==I?x/2:0,"top"===I?g/2:0);for(var s=0;s<y.length-1;s++)_.addColorStop(s/(y.length-2),y[s]);p=_}var b=function(t){if(e.enableColorFading&&!C){var i=5,a=e.list.length/i,o=Math.floor(f/a)+1,n=Math.min(o*e.colorFadingLevel,1),r=e.enableOptimize&&f<e.optimizedWordNum?1:1-n;return Q(t,r)}return t};if(l.fillStyle=b(p),l.translate((i+n.gw/2)*k*h,(o+n.gh/2)*k*h),m){var S;if(C){S=l.createLinearGradient("top"!==I?-n.fillTextOffsetX*h-4/h/2:0,"top"===I?-n.fillTextOffsetY*h-4/h/2:0,"top"!==I?n.fillTextOffsetX*h-4/h/2:0,"top"===I?n.fillTextOffsetY*h-4/h/2:0);for(var s=0;s<y.length-1;s++)S.addColorStop(s/(y.length-2),Q(y[y.length-2-s],.2))}G(l,n.fillTextOffsetX*h-2/h,n.fillTextOffsetY*h-2/h,l.measureText(r).width+4/h,g+4/h,4/h,C?S:Q(y?y:p,.2),C?y[0]:y?y:p,-c)}l.shadowColor=e.shadowColor,l.shadowOffsetX=e.shadowOffsetX,l.shadowOffsetY=e.shadowOffsetY,l.shadowBlur=e.shadowBlur,0!==c&&l.rotate(-c),l.textBaseline="middle",l.fillText(r,n.fillTextOffsetX*h,(n.fillTextOffsetY+.5*g)*h),l.restore()}else{C&&(p=y);var M=document.createElement("div"),F=document.createElement("span"),z="";z="rotate("+-c/Math.PI*180+"deg) ",1!==n.mu&&(z+="translateX(-"+n.fillTextWidth/4+"px) scale("+1/n.mu+")");var T=a({position:"absolute",display:"block",font:v+" "+g*n.mu+"px "+u.fontFamily,left:(i+n.gw/2)*k+n.fillTextOffsetX+"px",top:(o+n.gh/2)*k+n.fillTextOffsetY+"px",width:n.fillTextWidth+"px","box-sizing":"border-box","border-radius":"4px","border-style":"solid","border-width":"1px","border-color":"transparent",lineHeight:g+"px",whiteSpace:"nowrap",transform:z,webkitTransform:z,msTransform:z,transformOrigin:"50% 40%",webkitTransformOrigin:"50% 40%",msTransformOrigin:"50% 40%"},"font",v+" "+g*n.mu+"px "+u.fontFamily),E={display:"block",font:v+" "+g*n.mu+"px "+u.fontFamily,filter:"drop-shadow("+e.shadowOffsetX+"px "+e.shadowOffsetY+"px "+e.shadowBlur+"px "+e.shadowColor+")"};m&&(T=Object.assign(T,a({"border-color":C?p[0]:p,"border-style":"solid","border-width":"1px"},"border-color",C?p[0]:p)),C?T.backgroundImage="-webkit-linear-gradient("+I+","+p.filter(function(t,e){return e!=p.length-1}).map(function(t){return Q(t,.2)}).join(",")+")":T.backgroundColor=Q(p,.2)),p&&("[object Array]"===Object.prototype.toString.call(p)&&(E=Object.assign({webkitBackgroundClip:"text",webkitTextFillColor:"transparent",backgroundImage:"-webkit-linear-gradient("+I+","+p.filter(function(t,e){return e!=p.length-1}).join(",")+")"},E)),E.color=p),F.textContent=r;for(var O in T)M.style[O]=T[O];for(var O in E)F.style[O]=E[O];if(d)for(var P in d)F.setAttribute(P,d[P]);w&&(F.className+=w),M.appendChild(F),t.appendChild(M)}})},$=function(e,i,a,o,n,r){if(!(e>=w||i>=x||e<0||i<0)){if(v[e][i]=!1,a){var s=t[0].getContext("2d");s.fillRect(e*k,i*k,I,I)}R&&(A[e][i]={item:n,dimension:o,index:r})}},K=function(e,i,a,o,n,r,s){var l,h=n.occupied,c=u.drawMask;c&&(l=t[0].getContext("2d"),l.save(),l.fillStyle=u.maskColor);var d;if(R){var f=n.bounds;d={x:(e+f[3])*k,y:(i+f[0])*k,w:(f[1]-f[3]+1)*k,h:(f[2]-f[0]+1)*k}}for(var m=h.length;m--;){var p=e+h[m][0],g=i+h[m][1];p>=w||g>=x||p<0||g<0||$(p,g,c,d,r,s)}c&&l.restore()},V=function(t,i){var a,o,n,r,s,h=i;Array.isArray(t)?(a=t[0],o=t[1],r=t[2]):(a=t.word,o=t.weight,n=t.attributes,r=t.highlight);var c=function(e){var i=q(),c=X(a,o,i,!0,e);if(s=c.fontSize,!c)return!1;if(N())return!1;if(!u.drawOutOfBound){var d=c.bounds;if(d[1]-d[3]+1>w||d[2]-d[0]+1>x)return!1}for(var f=S+1,p=function(e,s){var l=Math.floor(e[0]-c.gw/2),h=Math.floor(e[1]-c.gh/2),d=c.gw,u=c.gh;if(!J(l,h,d,u,c.occupied))return!1;var p={gx:l,gy:h,info:c,word:a,weight:o,distance:S-f,theta:e[2],attributes:n,item:t,i:s,highlight:r,rotateDeg:i};return m.words.push(p),p};f--;){var g=H(S-f);u.shuffle&&(g=[].concat(g),l(g));for(var v,b=0;b<g.length;b++){var y=p(g[b],h);if(y){v=y;break}}if(v)return v}return!1},d=c();if(d)return d;if(!(e.autoFontSize&&h>=u.topN))return!1;if(s<=e.minFontSize)return!1;for(;!d;)if(d=c(s))return e.maxFontSize=s,d},Z=function(t,i){var a,o,n,r,s,l=[b[0],b[1],0],h=[l].concat(y.map(function(t){return[t[0],t[1],0]})),c=i;Array.isArray(t)?(a=t[0],o=t[1],r=t[2]):(a=t.word,o=t.weight,n=t.attributes,r=t.highlight);var d=function(e,i){var l=q(),h=X(a,o,l,!1,i);if(s=h.fontSize,!h)return!1;if(N())return!1;if(!u.drawOutOfBound){var d=h.bounds;if(d[1]-d[3]+1>w||d[2]-d[0]+1>x)return!1}var f=S+1,p=function(t){for(var e=0,i=0;i<t.length;i++){var a=t.charCodeAt(i);e+=a>=19968&&a<=40959?2:1}return e},g=function(t){var e=p(t),i=[{characters:4,widthPercentage:.55},{characters:6,widthPercentage:.62},{characters:8,widthPercentage:.8}],a=null,o=1/0,n=!0,r=!1,s=void 0;try{for(var l,h=i[Symbol.iterator]();!(n=(l=h.next()).done);n=!0){var c=l.value,d=Math.abs(e-c.characters);d<o&&(o=d,a=c)}}catch(t){r=!0,s=t}finally{try{!n&&h.return&&h.return()}finally{if(r)throw s}}return a?a.widthPercentage:.75},v=function(e,i){var s=Y(h,i),l=Math.floor(e[0]-s.x),c=Math.floor(e[1]-s.y),d=h.gw,u=h.gh,p=g(a),v=function(t,e){switch(e){case 0:return!0;default:return t/Math.min(w,x)<=p}};if(!J(l,c,d,u,h.occupied)||!v(d,i))return!1;var b={gx:l,gy:c,info:h,word:a,weight:o,distance:S-f,theta:e[2],attributes:n,item:t,i:i,highlight:r,rotateDeg:0};return m.words.push(b),b},b=v(e,c);return!!b&&b},f=h[c],p=(0===i?void 0:e.maxFontSize,d(f));if(p)return p;if(s<=e.minFontSize)return!1;for(;!p;)if(p=d(f,s))return e.maxFontSize=e.maxFontSize*u.autoRatio,p},tt=function(e,i,a){return i?!t.some(function(t){var o=document.createEvent("CustomEvent");return o.initCustomEvent(e,!0,i,a||{}),!t.dispatchEvent(o)},this):void t.forEach(function(t){var o=document.createEvent("CustomEvent");o.initCustomEvent(e,!0,i,a||{}),t.dispatchEvent(o)},this)},et=function(t){var e=document.createElement("canvas"),i=e.getContext("2d");i.fillStyle=t,i.fillRect(0,0,1,1);var a=i.getImageData(0,0,1,1).data;return e=i=void 0,a},it=function(){var a=i;if(a.getContext)w=Math.ceil(a.width/k),x=Math.ceil(a.height/k);else{var o=a.getBoundingClientRect();w=Math.ceil(o.width/k),x=Math.ceil(o.height/k)}if(tt("wordcloudstart",!0)){b=u.origin?[u.origin[0]/k,u.origin[1]/k]:[w/2,x/2];var r=Math.abs(Math.floor((w-x)/2)),s=w>x?[r,0]:[0,r],l=w>x?[r,x-1]:[0,r+w-1],f=w>x?[r+x-1,0]:[w-1,r],p=w>x?[r+x-1,x-1]:[w-1,r+w-1];y=[s,l,f,p],_=e.maxFontSize,S=Math.floor(Math.sqrt(w*w+x*x)),v=[];var g,M,I,F,z=e.maxFontSize;if(t.forEach(function(t){if(t.getContext){var e=t.getContext("2d");e.fillStyle=u.backgroundColor,e.clearRect(0,0,w*(k+1),x*(k+1)),e.fillRect(0,0,w*(k+1),x*(k+1))}else t.textContent="",t.style.position="relative"}),!a.getContext||u.clearCanvas)for(g=w;g--;)for(v[g]=[],M=x;M--;)v[g][M]=!0;else{var T=et("#ffffff"),E=a.getContext("2d").getImageData(0,0,w*k,x*k).data;g=w;for(var O,L;g--;)for(v[g]=[],M=x;M--;){L=k;t:for(;L--;)for(O=k;O--;)for(I=4;I--;)if(E[4*((M*k+L)*w*k+(g*k+O))+I]!==T[I]){v[g][M]=!1;break t}v[g][M]!==!1&&(v[g][M]=!0)}E=T=void 0}if(h(),n()&&(m.maskCanvas=i),e.enableSquareAdaptor&&0!==r)for(var I=0;I<w;I++)for(var D=0;D<x;D++)w>x?(I<r||I>r+x-1)&&(v[I][D]=!1):w<x&&(D<r||D>r+w-1)&&(v[I][D]=!1);if("circle"===e.shape)for(var H=Math.min(w,x)/2,I=0;I<w;I++)for(var D=0;D<x;D++)(I-w/2)*(I-w/2)+(D-x/2)*(D-x/2)>H*H&&(v[I][D]=!1);if(F=JSON.parse(JSON.stringify(v)),u.hover||u.click){for(R=!0,g=w+1;g--;)A[g]=[];var q=function(t){t.preventDefault()};t.forEach(function(t){u.hover&&(t.addEventListener("mousemove",j),t.addEventListener("mouseout",W)),u.click&&(t.addEventListener("click",B),t.addEventListener("touchstart",B),t.addEventListener("touchend",q),t.style.webkitTapHighlightColor="rgba(0, 0, 0, 0)"),t.addEventListener("wordcloudstart",function e(){t.removeEventListener("wordcloudstart",e),t.removeEventListener("mousemove",j),t.removeEventListener("mouseout",W),t.removeEventListener("click",B),t.removeEventListener("touchstart",B),t.removeEventListener("touchend",q),P=void 0})})}I=0;var X,Y;0!==u.wait?(X=window.setTimeout,Y=window.clearTimeout):(X=window.setImmediate,Y=window.clearImmediate);var J=function(e,i){t.forEach(function(t){t.addEventListener(e,i)},this)},G=function(e,i){t.forEach(function(t){t.removeEventListener(e,i)},this)},Q=function t(){G("wordcloudstart",t),Y(U)};J("wordcloudstart",Q);var U=X(function t(){if(I>=u.list.length)return Y(U),tt("wordcloudstop",!1),void G("wordcloudstart",Q);C=(new Date).getTime();var i;u.enableSquareAdaptor&&I<5?i=Z(u.list[I],I):i||(i=V(u.list[I],I));var a=e.enableSquareAdaptor?Math.min(30,e.list.length):u.topN+1;if(i&&I===a-1)for(var o=0;o<a;o++)m.drawItem(m.words[o],!0);else I>=a&&m.drawItem(i,!0);I<=a-1&&!i?(z*=u.autoRatio,e.maxFontSize=z,_=e.maxFontSize,m.words=[],v=JSON.parse(JSON.stringify(F)),I=0):I++,m.drawItem(i);var n=!tt("wordclouddrawn",!0,{item:u.list[I],drawn:i&&!0});return N()||n?(Y(U),u.abort(),tt("wordcloudabort",!1),tt("wordcloudstop",!1),void G("wordcloudstart",Q)):void(U=X(t,u.wait))},u.wait);if(d){var $=d.getContext("2d"),K=c($);d.width=d.width*K,d.height=d.height*K,$.scale(K,K),n()&&($.globalCompositeOperation="source-over",$.drawImage(i,0,0))}}};return it(),this}};h.prototype.highlight=function(t,e){var i=this;i.elements.forEach(function(a,o){a.getContext?a.getContext("2d").clearRect(0,0,a.width,a.height):a.innerHTML="",i.words.forEach(function(a){e||(a.highlight=!1),a.i===t&&(a.highlight=!0),i.drawItem(a,!0)});var n=a.getContext("2d");n&&i.maskCanvas&&(n.globalCompositeOperation="source-over",n.drawImage(i.maskCanvas,0,0))})},h.prototype.downplay=function(t,e){var i=this;i.elements.forEach(function(e,a){e.getContext?e.getContext("2d").clearRect(0,0,e.width,e.height):e.innerHTML="",i.words.forEach(function(e){e.i===t&&(e.highlight=!1),i.drawItem(e,!0)});var o=e.getContext("2d");o&&i.maskCanvas&&(o.globalCompositeOperation="source-over",o.drawImage(i.maskCanvas,0,0))})},h.isSupported=r,h.minFontSize=s,i.WordCloud=h,o=[],n=function(){return h}.apply(e,o),!(void 0!==n&&(t.exports=n))}(this)}).call(window)}])});